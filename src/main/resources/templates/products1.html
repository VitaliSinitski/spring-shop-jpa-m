<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}"/>
</head>

<body>

<!-- Include header -->
<div th:include="header.html"></div>

<!-- Include menu -->
<!--<div class="menu">-->
<!--    <div th:include="menu.html"></div>-->
<!--</div>-->

<!-- Display all products -->
<div class="container">
    <br>
    <div>
        <!--  Sort form -->
        <!--        <form action="/products" method="get">-->
        <form id="filter-form" action="/products" method="get">

            <label for="name">Name:
                <input id="name" type="text" name="name" th:value="${filter.name}">
            </label>
            <label for="price">Price:
                <input id="price" type="number" name="price" th:value="${filter.price}">
            </label>
            <label for="category">Category:
                <select id="category" name="categoryId" onchange="this.form.submit()">
                    <option value="">All categories</option>
                    <option th:each="category : ${categories}" th:value="${category.id}"
                            th:text="${category.name}" th:selected="${category.id == filter.categoryId}"></option>
                </select>
            </label>
            <label for="producer">Producer:
                <select id="producer" name="producerId" onchange="this.form.submit()">
                    <option value="">All producers</option>
                    <option th:each="producer : ${producers}" th:value="${producer.id}"
                            th:text="${producer.name}" th:selected="${producer.id == filter.producerId}"></option>
                </select>
            </label>
            <input type="hidden" name="sortField" th:value="${sortField}">
            <input type="hidden" name="sortDirection" th:value="${sortDirection}">
            <label for="pageSize">Items per page:</label>
            <select id="pageSize" name="size" onchange="this.form.submit()">
                <option value="5" th:selected="${page.size == 5}">5</option>
                <option value="10" th:selected="${page.size == 10}">10</option>
                <option value="20" th:selected="${page.size == 20}">20</option>
            </select>
            <button type="submit">Filter</button>
            <button type="reset" onclick="resetFilter()">Reset</button>
        </form>

    </div>

    <script>
        function resetFilter() {
            document.getElementById("name").value = "";
            document.getElementById("price").value = "";
            document.getElementById("category").value = "";
            document.getElementById("producer").value = "";
            document.getElementById("pageSize").value = "5";
            document.getElementById("filter-form").submit();
        }
    </script>

    <br>
    <div class="product-grid">
        <div class="product-items" th:each="product : ${page.content}">
            <div class="product">
                <div th:if="${product.image}" class="product-image">
                    <img th:src="@{/api/v1/products/{id}/image(id=${product.id})}" alt="Image" height="200">
                </div>
                <div class="product-info">
                    <div class="product-name" th:text="${product.name}"></div>
                    <div class="product-description" th:text="${product.description}"></div>
                    <div class="product-price" th:text="${product.price}"></div>

                    <!-- Link to product details page -->
                    <div class="product-action">
                        <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-primary" role="button">Show</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination">
        <form action="/products" method="get">
            <input type="hidden" name="name" th:value="${filter.name}"/>
            <input type="hidden" name="price" th:value="${filter.price}"/>
            <input type="hidden" name="sortField" th:value="${sortField}"/>
            <input type="hidden" name="sortDirection" th:value="${sortDirection}"/>
            <input type="hidden" name="size" th:value="${page.size}"/>

            <div th:if="${page.number > 0}" style="display: inline-block;">
                <button type="submit" name="page" th:value="${page.number - 1}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </button>
            </div>

            <div th:each="i : ${#numbers.sequence(0, page.totalPages-1)}" style="display: inline-block;">
                <button type="submit" name="page" th:value="${i}" th:text="${i+1}"
                        th:class="${i==page.number ? 'active' : ''}"></button>
            </div>

            <div th:if="${page.number < page.totalPages-1}" style="display: inline-block;">
                <button type="submit" name="page" th:value="${page.number + 1}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </button>
            </div>
        </form>
    </div>


</div>

<footer th:replace="footer :: footer"></footer>

</body>

</html>
